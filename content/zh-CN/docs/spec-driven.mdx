import { Callout } from 'nextra/components';

# 规格驱动开发

规格驱动开发是一种结构化方法，将粗略想法转化为完整设计和可执行的实施计划。它将头脑风暴、设计文档和基于计划的执行整合为一个连贯的工作流。

## 概述

规格驱动工作流包含四个阶段：

1. **头脑风暴** – 通过结构化提问完善想法
2. **保存设计** – 记录设计决策
3. **编写计划** – 创建详细的实施步骤
4. **执行计划** – 分批实施并设置检查点

## 计划模式 vs 头脑风暴模式

Neovate Code 提供两种互补的模式，用于编码前的思考：

| 模式 | 用途 | 切换方式 |
|------|------|----------|
| **计划模式** | 执行前将任务分解为步骤 | Shift+Tab |
| **头脑风暴模式** | 通过问答对话探索想法 | Shift+Tab（按两次） |

按 `Shift+Tab` 循环切换：普通 → 计划模式 → 头脑风暴模式 → 普通。

### 计划模式

在计划模式下，Neovate 在采取行动前创建结构化计划。响应会列出将要执行的步骤，让你在执行前审查和批准。

### 头脑风暴模式

在头脑风暴模式下（以 🧠 标识），Neovate 进行协作式设计探索：

- 每次只问一个问题来理解你的需求
- 提出 2-3 个备选方案
- 逐步呈现设计以供验证
- 头脑风暴期间不编写代码

## 斜杠命令

### /spec:brainstorm

通过结构化对话将粗略想法转化为设计。

```
/spec:brainstorm 添加带 OAuth 的用户认证
```

**流程：**

**阶段 1：理解**
- 检查当前项目状态
- 逐一询问澄清问题
- 收集目的、约束和成功标准

**阶段 2：探索**
- 提出 2-3 种不同方案
- 评估权衡和复杂度
- 询问哪种方案更合适

**阶段 3：设计呈现**
- 以 200-300 字的段落呈现设计
- 涵盖架构、组件、数据流、错误处理
- 在继续前验证每个部分

<Callout type="info">
  头脑风暴模式可以在需要时回退。如果出现新的约束或需要重新思考方案，它会重新访问早期阶段。
</Callout>

### /spec:save-design

头脑风暴后，将会话保存为设计文档。

```
/spec:save-design
```

在 `docs/designs/YYYY-MM-DD-<功能名称>.md` 创建结构化文档，包含：

- **背景** – 初始想法和动机
- **讨论** – 关键问题、权衡、探索的备选方案
- **方案** – 最终确定的方向
- **架构** – 技术细节和实施说明

### /spec:write-plan

从设计或想法创建全面的实施计划。

```
/spec:write-plan 实现 OAuth 认证
```

计划保存到 `docs/plans/YYYY-MM-DD-<功能名称>.md`，包括：

- **头部** – 目标、架构、技术栈
- **小步骤任务** – 每个步骤 2-5 分钟的工作
- **精确文件路径** – 要创建/修改的文件
- **完整代码** – 不是"添加验证"而是实际代码
- **测试命令** – 精确命令和预期输出

任务结构示例：

```markdown
### 任务 1：创建认证服务

**文件：**
- 创建：`src/services/auth.ts`
- 测试：`tests/services/auth.test.ts`

**步骤 1：编写失败的测试**
[代码]

**步骤 2：运行测试验证失败**
运行：`npm test -- auth.test.ts`
预期：FAIL

**步骤 3：编写最小实现**
[代码]

**步骤 4：运行测试验证通过**
运行：`npm test -- auth.test.ts`
预期：PASS
```

### /spec:execute-plan

分批执行实施计划并设置检查点。

```
/spec:execute-plan docs/plans/2024-01-15-oauth.md
```

**执行流程：**

1. **加载和审查** – 读取计划，识别问题，创建待办列表
2. **执行批次** – 严格按步骤完成前 3 个任务
3. **报告** – 展示实施内容和验证输出
4. **继续** – 应用反馈，执行下一批次
5. **完成** – 所有任务完成后宣布

<Callout type="warning">
  遇到阻碍时立即停止执行。代理会请求澄清而不是猜测。
</Callout>

## 工作流示例

典型的规格驱动工作流：

```bash
# 1. 头脑风暴功能
/spec:brainstorm 为 API 端点添加速率限制

# 2. 问答对话后，保存设计
/spec:save-design

# 3. 创建实施计划
/spec:write-plan

# 4. 执行计划
/spec:execute-plan docs/plans/2024-01-15-rate-limiting.md
```

## 最佳实践

- **需求不明确时使用头脑风暴模式** – 让问答过程揭示约束
- **执行前审查计划** – 计划应包含工程师需要的所有上下文
- **拥抱迭代** – 需要时回退，灵活性胜过僵化的流程
- **保持任务原子化** – 每个步骤应该是 2-5 分钟的专注工作
- **运行验证** – 不要跳过计划中的测试步骤
